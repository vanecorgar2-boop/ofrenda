<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Catrina</title>
</head>
<body>
<canvas id="miCanvas"></canvas>

<script type="importmap">
{
    "imports": {
        "three": "./js/three.module.js",
        "three/OrbitControls": "./js/OrbitControls.js"
    }
}
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/OrbitControls';

// Renderizador
var render = new THREE.WebGLRenderer({canvas: document.getElementById('miCanvas'), antialias: true});
render.setSize(window.innerWidth, window.innerHeight);
render.setClearColor(0xB8E0F5);
render.setPixelRatio(window.devicePixelRatio);

// Escena y cámara
var escena = new THREE.Scene();
var camara = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 2000);
camara.position.set(0, 5, 20);
escena.add(camara);

// Controles
var control = new OrbitControls(camara, render.domElement);

// Luces
var luz1 = new THREE.DirectionalLight(0xffffff, 1);
luz1.position.set(10, 20, 10);
escena.add(luz1);
var luz2 = new THREE.AmbientLight(0xffffff, 0.4);
escena.add(luz2);

///// CATRINA
function Catrina({ x, y, z }) {

    // grupo principal
    var catrinaGroup = new THREE.Group();

    // coloress
    var blanco = new THREE.MeshLambertMaterial({ color: 0xffffff });
    var negro = new THREE.MeshLambertMaterial({ color: 0x000000 });
    var rosa = new THREE.MeshLambertMaterial({ color: 0xff6fa1 });
    var dorado = new THREE.MeshLambertMaterial({ color: 0xffd700 });
    var morado = new THREE.MeshLambertMaterial({ color: 0x800080 });
    var petalo_mat = new THREE.MeshLambertMaterial({ color: 0xFF66B2 });
    var centro_mat = new THREE.MeshLambertMaterial({ color: 0xFFD700 });
    var petalo_mat1 = new THREE.MeshLambertMaterial({ color: 0xCC4FFF });
    var centro_mat1 = new THREE.MeshLambertMaterial({ color: 0xFFD700 });

    // Cabeza
    var cabeza = new THREE.Mesh(new THREE.SphereGeometry(3, 32, 32), blanco);
    cabeza.position.set(0, 5, 0);
    catrinaGroup.add(cabeza);

    // Ojos
    var ojo_geo = new THREE.SphereGeometry(0.6, 20, 20);
    var ojo_izq = new THREE.Mesh(ojo_geo, negro);
    ojo_izq.position.set(-1.2, 5, 2.5);
    catrinaGroup.add(ojo_izq);
    var ojo_der = new THREE.Mesh(ojo_geo, negro);
    ojo_der.position.set(1.3, 5, 2.5);
    catrinaGroup.add(ojo_der);

    // Contorno ojos
    var contorno_geo = new THREE.SphereGeometry(1.3, 24, 25);
    var contorno_izq = new THREE.Mesh(contorno_geo, rosa);
    contorno_izq.position.set(-0.9, 5, 1.7);
    catrinaGroup.add(contorno_izq);
    var contorno_der = new THREE.Mesh(contorno_geo, rosa);
    contorno_der.position.set(1, 5, 1.7);
    catrinaGroup.add(contorno_der);

    // Nariz
    var nariz = new THREE.Mesh(new THREE.ConeGeometry(0.4, 1, 3), negro);
    nariz.rotation.x = -1.57;
    nariz.position.set(0, 4, 2.6);
    catrinaGroup.add(nariz);

    // Boca
    var boca = new THREE.Mesh(new THREE.BoxGeometry(2.4, 0.3, 0.2), negro);
    boca.position.set(0, 3, 2.5);
    catrinaGroup.add(boca);

    // Sombrero
    var sombrero = new THREE.Group();
    sombrero.position.set(0, 8, 0);
    sombrero.add(new THREE.Mesh(new THREE.CylinderGeometry(7, 7, 0.8, 64), negro));
    var copa = new THREE.Mesh(new THREE.CylinderGeometry(3, 3, 3.5, 32), negro);
    copa.position.set(0, 2, 0);
    sombrero.add(copa);
    var borde = new THREE.Mesh(new THREE.CylinderGeometry(7.2, 7.2, 0.15, 64), dorado);
    borde.position.set(0, 0.5, 0);
    sombrero.add(borde);
    catrinaGroup.add(sombrero);
    catrinaGroup.sombrero = sombrero;

    // Flores grandes
    var florb = new THREE.Group();
    var centro = new THREE.Mesh(new THREE.SphereGeometry(0.4, 12, 12), centro_mat);
    florb.add(centro);

    var p1 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p1.position.set(0.8, 0, 0);
    florb.add(p1);
    var p2 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p2.position.set(-0.8, 0, 0);
    florb.add(p2);
    var p3 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p3.position.set(0, 0.8, 0);
    florb.add(p3);
    var p4 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p4.position.set(0, -0.8, 0);
    florb.add(p4);
    var p5 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p5.position.set(0.6, 0.6, 0);
    florb.add(p5);
    var p6 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p6.position.set(-0.6, 0.6, 0);
    florb.add(p6);
    var p7 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p7.position.set(0.6, -0.6, 0);
    florb.add(p7);
    var p8 = new THREE.Mesh(new THREE.SphereGeometry(0.6, 12, 12), petalo_mat);
    p8.position.set(-0.6, -0.6, 0);
    florb.add(p8);

    // Clonar y colocar flores grandes
    var flor1 = florb.clone(); flor1.position.set(0, 9.8, 2.7); catrinaGroup.add(flor1);
    var flor2 = florb.clone(); flor2.position.set(2, 9.8, 2.6); catrinaGroup.add(flor2);
    var flor3 = florb.clone(); flor3.position.set(-2, 9.8, 2.4); catrinaGroup.add(flor3);
    var flor4 = florb.clone(); flor4.position.set(1, 5, 2); catrinaGroup.add(flor4);
    var flor5 = florb.clone(); flor5.position.set(-1, 5, 2); catrinaGroup.add(flor5);

    // Flores chicas
    var florch = new THREE.Group();
    var centro1 = new THREE.Mesh(new THREE.SphereGeometry(0.5, 15, 12), centro_mat1);
    florch.add(centro1);

    var p1c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p1c.position.set(0.7, 0, 0.3);
    florch.add(p1c);
    var p2c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p2c.position.set(-0.7, 0, 0.3);
    florch.add(p2c);
    var p3c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p3c.position.set(-0.1, 0.7, 0.3);
    florch.add(p3c);
    var p4c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p4c.position.set(-0.1, -0.7, 0.3);
    florch.add(p4c);
    var p5c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p5c.position.set(0.5, 0.5, 0.3);
    florch.add(p5c);
    var p6c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p6c.position.set(-0.5, 0.5, 0.3);
    florch.add(p6c);
    var p7c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p7c.position.set(0.5, -0.5, 0.3);
    florch.add(p7c);
    var p8c = new THREE.Mesh(new THREE.SphereGeometry(0.3, 12, 12), petalo_mat1);
    p8c.position.set(-0.5, -0.5, 0.3);
    florch.add(p8c);

    // Clonar y colocar flor chica
    var flor6 = florch.clone();
    flor6.position.set(0, 6.9, 2.4);
    catrinaGroup.add(flor6);

    // Cuerpo y costillas
    var columna = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 6, 16), blanco);
    columna.position.set(0, -1, 0);
    catrinaGroup.add(columna);
    var costilla2 = new THREE.Mesh(new THREE.TorusGeometry(2.4, 0.12, 18, 70, 5.9), blanco);
    costilla2.rotation.y = 3.14;
    costilla2.position.set(0, -0.8, 0);
    catrinaGroup.add(costilla2);
    var costilla3 = new THREE.Mesh(new THREE.TorusGeometry(2.2, 0.12, 10, 60, 5.5), blanco);
    costilla3.rotation.y = 3.14;
    costilla3.position.set(0, -2.2, 0);
    catrinaGroup.add(costilla3);
    var costilla4 = new THREE.Mesh(new THREE.TorusGeometry(2.0, 0.12, 10, 60, 5.5), blanco);
    costilla4.rotation.y = 3.14;
    costilla4.position.set(0, -3.6, 0);
    catrinaGroup.add(costilla4);

    // Pelvis
    var pelvis = new THREE.Mesh(new THREE.TorusGeometry(1.8, 0.15, 8, 40), blanco);
    pelvis.rotation.x = 1.57;
    pelvis.position.set(0, -4, 0);
    catrinaGroup.add(pelvis);

    // Brazos
    function crearBrazo(lado) {
        var brazo = new THREE.Group();
        var humero = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.4, 3, 16), blanco);
        humero.position.set(0, -1.5, 0);
        brazo.add(humero);
        var codo = new THREE.Mesh(new THREE.SphereGeometry(0.4, 16, 16), blanco);
        codo.position.set(0, -3, 0);
        brazo.add(codo);
        var ante = new THREE.Mesh(new THREE.CylinderGeometry(0.35, 0.35, 3, 16), blanco);
        ante.position.set(0, -4.5, 0);
        brazo.add(ante);
        var mano = new THREE.Mesh(new THREE.SphereGeometry(0.5, 16, 16), blanco);
        mano.position.set(0, -6, 0);
        brazo.add(mano);
        brazo.position.set(lado, 3, 0);
        brazo.rotation.z = lado * 0.6;
        catrinaGroup.add(brazo);
    }
    crearBrazo(1);
    crearBrazo(-1);

    
    // Posición general
    catrinaGroup.position.set(x, y, z);

    // Retornar grupo
    return catrinaGroup;
}

// Agregar Catrina a la escena
const miCatrina = Catrina({ x: 0, y: 0, z: 0 });
escena.add(miCatrina);



// Animación
function animar(){
    miCatrina.sombrero.rotation.y += 0.004;
    control.update();
    render.render(escena,camara);
    requestAnimationFrame(animar);
}
animar();
</script>
</body>
</html>
